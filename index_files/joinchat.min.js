((c,r,l)=>{l={$div:null,settings:null,store:null,chatbox:!1,showed_at:0,is_ready:!1,is_mobile:/Mobile|Android|iPhone|iPad/i.test(navigator.userAgent),can_qr:c.QrCreator&&"function"==typeof QrCreator.render,...l},(c.joinchat_obj=l).$=function(t){return this.$div.querySelector(t)},l.$$=function(t){return this.$div.querySelectorAll(t)},l.send_event=function(o){if((o={event_category:"JoinChat",event_label:"",event_action:"",chat_channel:"whatsapp",chat_id:"--",is_mobile:this.is_mobile?"yes":"no",page_location:location.href,page_title:r.title||"no title",...o}).event_label=o.event_label||o.link||"",o.event_action=o.event_action||o.chat_channel+": "+o.chat_id,delete o.link,r.dispatchEvent(new CustomEvent("joinchat:event",{detail:o,cancelable:!0}))){let t=c[this.settings.data_layer]||c[c.gtm4wp_datalayer_name]||c.dataLayer;if("object"==typeof t){let i=c.gtag||function(){t.push(arguments)},n=void 0!==this.settings.ga_event?this.settings.ga_event:"generate_lead";if(n){let e={transport_type:"beacon",...o},s=(Object.keys(e).forEach(t=>{"page_location"===t?e[t]=e[t].substring(0,1e3):"page_referrer"===t?e[t]=e[t].substring(0,420):"page_title"===t?e[t]=e[t].substring(0,300):"string"==typeof e[t]&&(e[t]=e[t].substring(0,100))}),[]),a=t=>{s.includes(t)||(t.startsWith("G-")||t.startsWith("GT-"))&&(s.push(t),i("event",n,{send_to:t,...e}))};if(c.google_tag_data&&google_tag_data.tidr&&google_tag_data.tidr.destination)for(var h in google_tag_data.tidr.destination)a(h);t.forEach(t=>{"config"===t[0]&&t[1]&&a(t[1])})}this.settings.gads&&i("event","conversion",{send_to:this.settings.gads})}var e,s,a=o.event_category;delete o.event_category,"object"==typeof t&&t.push({event:a,...o}),"function"==typeof fbq&&("whatsapp"===o.chat_channel&&(s=""+(e=o.chat_id).substring(0,3)+"X".repeat(e.length-5)+e.substring(e.length-2),o.chat_id=s,o.event_label=o.event_label.replace(e,s),o.event_action=o.event_action.replace(e,s)),fbq("trackCustom",a,o))}},l.get_wa_link=function(t,e,s){e=void 0!==e?e:this.settings.message_send||"",s=void 0!==s?s:this.settings.whatsapp_web&&!this.is_mobile;s=new URL((s?"https://web.whatsapp.com/send?phone=":"https://wa.me/")+(t||this.settings.telephone));return e&&s.searchParams.set("text",e),s.toString()},l.show=function(t){this.$div.removeAttribute("hidden"),this.$div.classList.add("joinchat--show"),t&&this.$div.classList.add("joinchat--tooltip")},l.hide=function(){this.$div.classList.remove("joinchat--show")},l.chatbox_show=function(){this.chatbox||(this.chatbox=!0,this.showed_at=Date.now(),this.$div.classList.add("joinchat--chatbox"),this.settings.message_badge&&this.$(".joinchat__badge").classList.replace("joinchat__badge--in","joinchat__badge--out"),r.dispatchEvent(new Event("joinchat:show")))},l.chatbox_hide=function(){this.chatbox&&(this.chatbox=!1,this.$div.classList.remove("joinchat--chatbox","joinchat--tooltip"),this.settings.message_badge&&this.$(".joinchat__badge").classList.remove("joinchat__badge--out"),r.dispatchEvent(new Event("joinchat:hide")))},l.save_hash=function(){var t;!this.settings.message_hash||this.settings.message_delay<0||(t=(this.store.getItem("joinchat_hashes")||"").split(",").filter(Boolean)).includes(this.settings.message_hash)||(t.push(this.settings.message_hash),this.store.setItem("joinchat_hashes",t.join(",")))},l.open_whatsapp=function(t,e){t=t||this.settings.telephone,e=void 0!==e?e:this.settings.message_send||"";t={link:this.get_wa_link(t,e),chat_channel:"whatsapp",chat_id:t,chat_message:e};r.dispatchEvent(new CustomEvent("joinchat:open",{detail:t,cancelable:!0}))&&(this.send_event(t),c.open(t.link,"joinchat","noopener"))},l.need_optin=function(){return this.$div.classList.contains("joinchat--optout")},l.use_qr=function(){return!!this.settings.qr&&this.can_qr&&!this.is_mobile},l.open=function(t,e,s){t&&!this.need_optin()||!l.$(".joinchat__chatbox")?Date.now()<l.showed_at+600||(this.save_hash(),this.open_whatsapp(e,s)):this.chatbox_show()},l.close=function(){this.save_hash(),this.chatbox_hide()},l.rand_text=function(t){t.querySelectorAll("jc-rand").forEach(t=>{var e=t.children;t.replaceWith(e[Math.floor(Math.random()*e.length)].innerHTML)})},l.qr=function(t,e){var s=r.createElement("CANVAS");return QrCreator.render(Object.assign({text:t,radius:.4,background:"#FFF",size:200*(c.devicePixelRatio||1)},this.settings.qr||{},e||{}),s),s};var t=()=>{if(l.$div=r.querySelector(".joinchat"),l.$div){l.settings=JSON.parse(l.$div.dataset.settings);try{localStorage.test=2,l.store=localStorage}catch(t){l.store={_data:{},setItem:function(t,e){this._data[t]=String(e)},getItem:function(t){return this._data.hasOwnProperty(t)?this._data[t]:null}}}if(l.settings&&l.settings.telephone){if(l.is_mobile||!l.settings.mobile_only){r.dispatchEvent(new Event("joinchat:starting"));var i=1e3*l.settings.button_delay,n=Math.max(0,1e3*l.settings.message_delay);let t=!!l.settings.message_hash;var o=parseInt(l.store.getItem("joinchat_views")||1)>=l.settings.message_views,h=(l.store.getItem("joinchat_hashes")||"").split(",").filter(Boolean);let s=void 0!==l.settings.cta_viewed?l.settings.cta_viewed:-1!==h.indexOf(l.settings.message_hash||"none"),e=!s&&(l.settings.message_badge||!t||!n||!o),a=(setTimeout(()=>l.show(e),i),()=>l.open());if(t&&!s&&n){let t;l.settings.message_badge?t=setTimeout(()=>l.$(".joinchat__badge").classList.add("joinchat__badge--in"),i+n):o&&(t=setTimeout(a,i+n)),r.addEventListener("joinchat:show",()=>clearTimeout(t),{once:!0})}if(h=l.$(".joinchat__button"),!l.is_mobile){let t;h.addEventListener("mouseenter",()=>{l.$(".joinchat__chatbox")&&(t=setTimeout(a,1500))}),h.addEventListener("mouseleave",()=>{clearTimeout(t)})}if(h.addEventListener("click",a),l.$(".joinchat__open")?.addEventListener("click",()=>l.open(!0)),l.$(".joinchat__close")?.addEventListener("click",()=>l.close()),l.$("#joinchat_optin")?.addEventListener("change",t=>l.$div.classList.toggle("joinchat--optout",!t.target.checked)),l.$(".joinchat__scroll")?.addEventListener("wheel",function(t){t.preventDefault(),this.scrollTop+=t.deltaY},{passive:!1}),l.is_mobile){let e,t,s=()=>{var t=(r.activeElement.type||"").toLowerCase();["date","datetime","email","month","number","password","search","tel","text","textarea","time","url","week"].includes(t)?l.chatbox?(l.chatbox_hide(),setTimeout(()=>l.hide(),400)):l.hide():l.show()};["focusin","focusout"].forEach(t=>r.addEventListener(t,t=>{t.target.matches("input, textarea")&&!l.$div.contains(t.target)&&(clearTimeout(e),e=setTimeout(s,200))})),c.addEventListener("resize",()=>{clearTimeout(t),t=setTimeout(()=>{l.$div.style.setProperty("--vh",c.innerHeight+"px")},200)}),c.dispatchEvent(new Event("resize"))}if(l.use_qr()?l.$(".joinchat__qr").appendChild(l.qr(l.get_wa_link(void 0,void 0,!1))):l.$(".joinchat__qr")?.remove(),n&&!o&&l.store.setItem("joinchat_views",parseInt(l.store.getItem("joinchat_views")||0)+1),r.addEventListener("joinchat:show",()=>{let s=l.$(".joinchat__scroll"),e=l.$(".joinchat__chat"),a=l.$$(".joinchat__bubble");if(!e)return;if(t&&l.rand_text(e),a.length<=1||c.matchMedia("(prefers-reduced-motion)").matches)return void setTimeout(()=>e.dispatchEvent(new Event("joinchat:bubbles")),1);a.forEach(t=>t.classList.add("joinchat--hidden")),l.$(".joinchat__optin")?.classList.add("joinchat--hidden");let i=0,n=(t,e)=>Math.round(Math.random()*(e-t)+t),o=(t,e)=>{l.$(".joinchat__bubble--loading")?.remove(),t.classList.remove("joinchat--hidden"),s.scrollTop=s.scrollHeight,setTimeout(h,e)},h=()=>{if(i>=a.length)l.$(".joinchat__optin")?.classList.remove("joinchat--hidden"),e.dispatchEvent(new Event("joinchat:bubbles"));else{let t=a[i++];t.classList.contains("joinchat__bubble--note")?o(t,100):(e.insertAdjacentHTML("beforeend",'<div class="joinchat__bubble joinchat__bubble--loading"></div>'),s.scrollTop=s.scrollHeight,setTimeout(()=>o(t,n(400,600)),60*t.textContent.split(/\s+/).length+n(100,200)))}};h()},{once:!0}),"#joinchat"!==(i=new URL(c.location)).hash&&!i.searchParams.has("joinchat")||(h=1e3*(parseInt(i.searchParams.get("joinchat"))||0),setTimeout(()=>l.show(),h),setTimeout(()=>l.chatbox_show(),700+h)),r.addEventListener("click",t=>{var e;t.target.closest('.joinchat_open, .joinchat_app, a[href="#joinchat"], a[href="#whatsapp"]')&&(t.preventDefault(),e=!!t.target.closest('.joinchat_app, a[href="#whatsapp"]'),l.open(e,t.target.dataset.phone,t.target.dataset.message))}),r.addEventListener("click",t=>{t.target.closest(".joinchat_close")&&(t.preventDefault(),l.close())}),n=r.querySelectorAll(".joinchat_show, .joinchat_force_show"),t&&n&&"IntersectionObserver"in c){let e=new IntersectionObserver(t=>{t.forEach(t=>{t.intersectionRatio<=0||s&&!t.target.classList.contains("joinchat_force_show")||(e.disconnect(),a())})});n.forEach(t=>e.observe(t))}l.is_ready=!0,r.dispatchEvent(new Event("joinchat:start"))}else l.hide(),r.addEventListener("click",t=>{t.target.closest('.joinchat_open, .joinchat_app, a[href="#joinchat"], a[href="#whatsapp"]')&&(t.preventDefault(),l.open_whatsapp(t.target.dataset.phone,t.target.dataset.message))});if(l.can_qr&&!l.is_mobile?r.querySelectorAll(".joinchat-button__qr").forEach(t=>t.appendChild(l.qr(l.get_wa_link(t.dataset.phone,t.dataset.message,!1)))):r.querySelectorAll(".wp-block-joinchat-button figure").forEach(t=>t.remove()),void 0!==l.settings.sku&&"function"==typeof jQuery){let a=l.settings.message_send;jQuery("form.variations_form").on("found_variation reset_data",function(t,e){let s=e&&e.sku||l.settings.sku;l.$$(".joinchat__chat jc-sku").forEach(t=>t.textContent=s),l.settings.message_send=a.replace(/<jc-sku>.*<\/jc-sku>/g,s)})}}}};"loading"!==r.readyState?t():r.addEventListener("DOMContentLoaded",t)})(window,document,window.joinchat_obj||{});